package com.project.controller;

import java.util.List;
import java.util.Locale.Category;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.project.model.KrhProduct;
import com.project.service.krhProductService;

import lombok.RequiredArgsConstructor;

@Controller
@RequiredArgsConstructor
public class krhProductController {
	private final krhProductService krhProductService;

	//리스트업
	@GetMapping("/productpage")
	public String list(Model model) {
		model.addAttribute("products",krhProductService.findAll());
		return "krhproduct";
	}
	
	//카테고리
	 @GetMapping("/productC")
	    public String getProductCategory(@RequestParam("category") String categoryId, Model model) {
		 Category category = krhProductService.getCategoryByCategoryById(categoryId);
		 List<KrhProduct> products = krhProductService.getProductsByCategoryId(categoryId);
	        // category_id와 category_name을 모델에 추가
	        model.addAttribute("category", categoryId);
	        model.addAttribute("products", products);
	        
	        // JSP 뷰 이름 반환
	        return "product";  // product.jsp로 포워딩
	    }
	
	//검색
	@GetMapping("/search")
	public String search(@RequestParam("keyword") String keyword, Model model) {
	    // 검색어 출력 (디버깅용)
	    System.out.println("------------" + keyword);
	    
	    if (keyword.isEmpty()) { // 검색어가 빈 값일 때
	        model.addAttribute("products", null);  // 빈 리스트 혹은 null을 설정
	        model.addAttribute("message", "찾으시는 상품이 없습니다.");
	    } else {
	    	List<KrhProduct> products = krhProductService.productPageSearch(keyword);
	        model.addAttribute("products", products);
	        if (products.isEmpty()) { // 검색어에 해당하는 상품이 없을 때
	            model.addAttribute("message", "찾으시는 상품이 없습니다.");
	        }
	    }
	    return "krhproduct";  // 상품을 보여줄 JSP 페이지
	}
}
